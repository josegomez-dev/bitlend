<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
  <title>BitLend • Bitcoin DeFi (Demo)</title>
  <meta name="description" content="BitLend demo: P2P lending secured by smart contracts. Single-file HTML/CSS/JS with loading screen, onboarding, avatar generator, animations, responsive layout, and toast badges."/>
  <style>
    :root{
      --bg:#0b0f14;         /* deep night */
      --panel:#101820;      /* darker panel */
      --muted:#6b7b8d;      /* text-muted */
      --accent:#ffb703;     /* golden */
      --accent-2:#06d6a0;   /* mint */
      --accent-3:#118ab2;   /* teal */
      --danger:#ff4d4d;
      --ok:#19d47b;
      --glass: rgba(255,255,255,0.06);
      --glass-brd: rgba(255,255,255,0.18);
      --radius: 16px;
      --shadow: 0 10px 40px rgba(0,0,0,.45);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 600px at 80% -10%, rgba(255,183,3,.15), transparent 60%),
                  radial-gradient(900px 500px at -10% 110%, rgba(17,138,178,.18), transparent 60%),
                  var(--bg);
      color:#e9eef5; overflow-x:hidden;
    }
    a{color:var(--accent)}

    /* ===== Loading Splash ===== */
    #splash{
      position:fixed; inset:0; display:grid; place-items:center; z-index:9999;
      background:linear-gradient(160deg,#0b0f14 0%, #0d1420 60%, #0b0f14 100%);
      animation: fadeBg 4s linear infinite alternate;
      padding: max(20px, env(safe-area-inset-top)) max(20px, env(safe-area-inset-right)) max(20px, env(safe-area-inset-bottom)) max(20px, env(safe-area-inset-left));
    }
    @keyframes fadeBg{to{filter:hue-rotate(-10deg) brightness(1.05)}}
    .coin{
      width:120px; aspect-ratio:1; border-radius:50%;
      background:radial-gradient(circle at 30% 30%, #fff3, #0000 35%),
                 conic-gradient(from 0deg, #ffcc59, #d89a00 40%, #ffd16b 60%, #a06b00 100%);
      box-shadow: inset 0 0 6px #0007, 0 10px 30px #0008;
      position:relative; transform-style:preserve-3d;
      animation: spin 1.3s linear infinite;
    }
    .coin::after{ /* ₿ */
      content:'₿'; position:absolute; inset:0; display:grid; place-items:center;
      font-weight:900; font-size:58px; color:#2b1b00; text-shadow:0 2px 0 #ffd16b50;
    }
    @keyframes spin{to{transform: rotateY(360deg)}}
    .progress{margin-top:24px; width:min(380px,80vw); height:8px; border-radius:999px; background:#ffffff1a; overflow:hidden}
    .progress>span{display:block; height:100%; width:0%; background:linear-gradient(90deg,var(--accent),#ffd36b); animation:load 2.4s ease-in-out infinite}
    @keyframes load{0%{width:0%} 60%{width:86%} 100%{width:98%}}
    .startBtn{margin-top:28px; padding:12px 22px; font-weight:700; border:none; border-radius:999px; cursor:not-allowed; opacity:.7}

    /* ===== Toast / Badge Notifications ===== */
    #toasts{
      position: fixed;
      top: max(14px, env(safe-area-inset-top));
      right: max(14px, env(safe-area-inset-right));
      display: grid;
      gap: 10px;
      z-index: 99999;
    }
    .toast{
      display:flex; align-items:flex-start; gap:10px;
      min-width:min(360px, 88vw);
      background: linear-gradient(180deg,#0f1622,#0b1119);
      border:1px solid var(--glass-brd);
      border-left:4px solid var(--accent);
      border-radius:14px;
      padding:12px 14px;
      box-shadow: var(--shadow);
      animation: slideIn .25s ease-out;
    }
    .toast.ok{ border-left-color: var(--ok); }
    .toast.err{ border-left-color: var(--danger); }
    .toast .ico{
      min-width:28px; min-height:28px; border-radius:50%;
      display:grid; place-items:center;
      background: #ffffff12; font-weight:900;
    }
    .toast.ok .ico{ background:#19d47b22 }
    .toast.err .ico{ background:#ff4d4d22 }
    .toast .body{ flex:1 }
    .toast .title{ font-weight:800; margin-bottom:2px }
    .toast .msg{ color:#bcd0e7; font-size:.95rem }
    .toast button.close{
      background:transparent; border:none; color:#9fb3cc; cursor:pointer; font-size:18px; line-height:1; padding:0 4px;
    }
    @keyframes slideIn{
      from{ opacity:0; transform: translateY(-8px) scale(.98); }
      to{ opacity:1; transform: none; }
    }

    /* ===== Onboarding Modal ===== */
    dialog#onboard{ border:none; padding:0; background:transparent }
    .modal{
      width:min(720px,92vw); margin:auto; background:linear-gradient(180deg, #0f1622 0%, #0c121b 100%);
      border:1px solid var(--glass-brd); border-radius:20px; box-shadow:var(--shadow);
      display:grid; grid-template-columns: 240px 1fr; overflow:hidden;
    }
    .modalLeft{
      background: radial-gradient(600px 300px at 10% -10%, #ffd36b12, transparent 60%), #0c121b;
      padding:22px; border-right:1px solid var(--glass-brd);
    }
    .avatarWrap{display:grid; place-items:center; gap:14px}
    canvas#avatar{width:160px; height:160px; border-radius:50%; border:2px solid #ffffff26; box-shadow: inset 0 0 0 6px #ffffff0f}
    .modalRight{padding:22px 22px 18px}
    .field{display:grid; gap:8px; margin:10px 0 12px}
    .field label{font-size:.9rem; color:#a8b3c3}
    .field input{padding:12px 14px; border-radius:12px; border:1px solid #1f2b3a; background:#0a0f15; color:#e9eef5}
    .row{display:flex; gap:10px; flex-wrap:wrap}
    .btn{
      padding:12px 16px; border-radius:12px; background:linear-gradient(90deg, var(--accent) 0%, #ffd36b 100%);
      border:none; font-weight:800; color:#1a1000; cursor:pointer; box-shadow:0 6px 20px #ffb70333; transition: transform .12s ease;
    }
    .btn:hover{transform: translateY(-1px)}
    .btn.ghost{background:#0a0f15; color:#dfe7f2; border:1px solid #1f2b3a; box-shadow:none}
    .btn.block{width:100%}

    /* ===== Layout ===== */
    header{
      position:sticky; top:0; z-index:9; backdrop-filter: blur(8px);
      background: linear-gradient(180deg, #0b0f14ee 30%, #0b0f1400 100%);
      border-bottom:1px solid #ffffff10;
    }
    .wrap{max-width:1200px; margin-inline:auto; padding:16px 18px}
    .brand{display:flex; align-items:center; gap:12px}
    .logo{width:36px; height:36px; border-radius:50%; background: radial-gradient(circle at 30% 30%, #fff3, #0000 35%), conic-gradient(#ffd36b, #ffb703 40%, #ffd36b 60%, #a06b00); box-shadow:inset 0 0 6px #0007}
    h1, h2, h3{margin:0}
    h1.grad{font-size: clamp(28px, 3.2vw, 40px); background:linear-gradient(90deg,#ffd36b, #ffb703, #06d6a0 70%); -webkit-background-clip:text; background-clip:text; color:transparent; letter-spacing:.4px}

    main{padding:22px 18px 66px}

    /* Hero */
    .hero{display:grid; grid-template-columns: 1.15fr .85fr; gap:22px; align-items:center}
    .card{background: linear-gradient(180deg, #0f1622 0%, #0b1119 100%); border:1px solid var(--glass-brd); border-radius:var(--radius); padding:18px; box-shadow: var(--shadow)}

    .tag{display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius:999px; font-size:.85rem; color:#0b0f14; background:linear-gradient(90deg,#06d6a0,#64f0cf)}
    .tag .dot{width:10px; height:10px; border-radius:50%; background:#0b0f14}

    .headline{font-size: clamp(30px, 5vw, 62px); line-height:1.05; margin:10px 0 8px; font-weight:900}
    .headline .sparkle{filter: drop-shadow(0 6px 14px #ffd36b44)}
    .lead{color:#b8c3d2}
    .ctaRow{display:flex; gap:12px; margin-top:14px; flex-wrap:wrap}

    .walletCard{display:grid; gap:14px}
    .statGrid{display:grid; grid-template-columns: repeat(3,1fr); gap:10px}
    .stat{padding:12px; border-radius:12px; background:var(--glass); border:1px solid var(--glass-brd); text-align:center}
    .stat .n{font-size:1.3rem; font-weight:900}

    /* Sections */
    .grid{display:grid; grid-template-columns: repeat(3,1fr); gap:18px}
    .grid .card{min-height:160px}

    /* App panel */
    .app{display:grid; grid-template-columns: 1fr 1fr 1fr; gap:18px; margin-top:22px}
    .app .panel{padding:18px; border-radius:var(--radius); background:linear-gradient(180deg,#0b1119,#0a0f15); border:1px solid var(--glass-brd)}
    .panel h3{margin-bottom:8px}
    .panel input{width:100%; padding:12px 14px; border-radius:12px; border:1px solid #1f2b3a; background:#0a0f15; color:#e9eef5}
    .panel .small{color:#93a3b5; font-size:.9rem}
    .balance{margin-top:8px; font-weight:700}

    /* Footer */
    footer{border-top:1px solid #ffffff10; color:#8ea0b6; padding:30px 18px}

    /* Animations */
    .typewriter{--caret: #ffd36b; position:relative}
    .typewriter::after{content:"|"; position:absolute; right:-10px; animation:blink .9s steps(1) infinite; color:var(--caret)}
    @keyframes blink{50%{opacity:0}}
    .reveal{opacity:0; transform: translateY(16px); transition: 600ms ease}
    .reveal.active{opacity:1; transform:none}

    /* ===== Mobile Enhancements / Centering ===== */
    @media (max-width: 980px){
      .hero{grid-template-columns: 1fr}
      .grid{grid-template-columns: 1fr}
      .app{grid-template-columns: 1fr;}
      .modal{grid-template-columns: 1fr}
      .modalLeft{border-right:none; border-bottom:1px solid var(--glass-brd)}
      .ctaRow, .row{justify-content:center}
      .walletCard, .card{ text-align: center; }
      .statGrid{ grid-template-columns: repeat(3, 1fr); }
      header .wrap{display:grid; grid-template-columns:1fr; gap:10px; justify-items:center; text-align:center}
      #userBadge{justify-content:center}
    }
    @media (max-width: 560px){
      .statGrid{ grid-template-columns: 1fr 1fr; }
      .ctaRow .btn, .row .btn{ flex: 1 1 42%; }
      .field input{ width:100% }
      .headline{ font-size: clamp(28px, 8vw, 44px); }
      .tag{ justify-content:center }
      .toast{ min-width: min(420px, 96vw); }
    }
  </style>
</head>
<body>
  <!-- ===== Loading Splash ===== -->
  <section id="splash" aria-label="Loading">
    <div style="text-align:center; max-width:92vw">
      <!-- <div class="coin" aria-hidden="true"></div> -->
      <img style="width: 120px; height: 120px;" src="./bitlend_coin.png" alt="logo" class="logo">
      <div class="progress" aria-hidden="true"><span></span></div>
      <button id="startLocked" class="startBtn" disabled>Preparing Web3…</button>
      <p style="margin-top:10px; color:#8ea0b6; font-size:.95rem; max-width:48ch; margin-inline:auto">
        Allowing peer to peer lending secured by smart contracts.
      </p>
    </div>
  </section>

  <!-- Toast container -->
  <div id="toasts" aria-live="polite" aria-atomic="true"></div>

  <!-- ===== Onboarding ===== -->
  <dialog id="onboard">
    <div class="modal">
      <div class="modalLeft">
        <div class="avatarWrap">
          <canvas id="avatar" width="320" height="320" aria-label="Generated avatar"></canvas>
          <button class="btn ghost" id="shuffleAvatar" type="button">Shuffle Art</button>
        </div>
      </div>
      <div class="modalRight">
        <div class="brand" style="margin-bottom:10px; align-items:center">
          <div class="logo" aria-hidden="true"></div>
          <h1 class="grad">BitLend</h1>
        </div>
        <p class="lead" style="margin:6px 0 10px">Peer-to-peer lending secured by smart contracts. Create your profile to get started.</p>
        <div class="field">
          <label for="nickname">Nickname</label>
          <input id="nickname" placeholder="e.g. Satoshi254" maxlength="28" autocomplete="nickname"/>
        </div>
        <div class="row">
          <button class="btn" id="enterApp" type="button">Enter App</button>
          <button class="btn ghost" id="randomName" type="button">Surprise me</button>
        </div>
        <p class="small" style="margin-top:8px">We’ll store nickname & avatar locally in your browser.</p>
      </div>
    </div>
  </dialog>

  <!-- ===== Header ===== -->
  <header>
    <div class="wrap" style="display:flex; justify-content:space-between; align-items:center; gap:12px">
      <div class="brand">
        <!-- <div class="logo"></div> -->
         <img style="width: 50px; height: 50px;" src="./bitlend_coin.png" alt="logo" class="logo">
        <h1 class="grad">BitLend</h1>
      </div>
      <div style="display:flex; align-items:center; gap:12px; flex-wrap:wrap; justify-content:flex-end">
        <button class="btn" id="btnConnect" type="button">Connect Wallet</button>
        <div id="userBadge" style="display:flex; align-items:center; gap:10px">
          <canvas id="badgeAvatar" width="36" height="36" style="border-radius:50%; border:1px solid #ffffff22"></canvas>
          <span id="badgeName" style="color:#cfe3fb; font-weight:700"></span>
        </div>
      </div>
    </div>
  </header>

  <!-- ===== Main ===== -->
  <main class="wrap">
    <section class="hero">
      <div class="card reveal">
        <span class="tag"><span class="dot"></span> Smart, community-first DeFi</span>
        <h2 class="headline">
          A brighter <span class="sparkle">Bitcoin</span> future for everyone
        </h2>
        <p class="lead typewriter" id="typer">In many regions—especially across Africa—people hold Bitcoin but lack access to loans and savings. BitLend connects peers so capital can flow fairly.</p>
        <div class="ctaRow">
          <button class="btn" id="ctaDeposit" type="button">Quick Deposit</button>
          <button class="btn ghost" id="ctaLearn" type="button">How it works</button>
        </div>
        <div class="statGrid" style="margin-top:16px">
          <div class="stat"><div class="n" id="statUsers">0</div><div class="t">Community profiles</div></div>
          <div class="stat"><div class="n" id="statTVL">0.0000</div><div class="t">BTC supplied</div></div>
          <div class="stat"><div class="n" id="statLoans">$0</div><div class="t">USDT borrowed</div></div>
        </div>
      </div>
      <div class="card walletCard reveal">
        <h3>Wallet</h3>
        <div id="walletStatus" class="small">Not connected</div>
        <div class="balance">BTC: <span id="btcBalance">0.0000</span></div>
        <div class="balance">Loan (USDT): <span id="usdtBalance">0</span></div>
        <div class="row">
          <button class="btn" id="connectWallet" type="button">Connect</button>
          <button class="btn ghost" id="disconnectWallet" type="button">Disconnect</button>
        </div>
      </div>
    </section>

    <section class="grid" style="margin-top:22px">
      <article class="card reveal">
        <h3>Deposit BTC</h3>
        <p class="small">Supply BTC to enable borrowing. (Demo rates, no real chain calls.)</p>
        <input type="number" id="inpDeposit" placeholder="Amount in BTC" step="0.0001" min="0" inputmode="decimal"/>
        <div class="row" style="margin-top:10px">
          <button class="btn" id="btnDeposit" type="button">Deposit</button>
          <button class="btn ghost" id="btnReset" type="button">Reset</button>
        </div>
      </article>
      <article class="card reveal">
        <h3>Borrow USDT</h3>
        <p class="small">You may borrow up to <b>60%</b> LTV at an assumed price of <b>1 BTC = $30,000</b>.</p>
        <input type="number" id="inpBorrow" placeholder="Amount in USDT" min="0" inputmode="decimal"/>
        <div class="row" style="margin-top:10px">
          <button class="btn" id="btnBorrow" type="button">Borrow</button>
        </div>
      </article>
      <article class="card reveal">
        <h3>Repay Loan</h3>
        <p class="small">Clear your outstanding USDT balance to free collateral.</p>
        <input type="number" id="inpRepay" placeholder="Repay in USDT" min="0" inputmode="decimal"/>
        <div class="row" style="margin-top:10px">
          <button class="btn" id="btnRepay" type="button">Repay</button>
        </div>
      </article>
    </section>

    <section class="card reveal" style="margin-top:22px">
      <h3>Why BitLend?</h3>
      <p class="lead" style="max-width:80ch; margin-inline:auto">BitLend helps Bitcoin holders—like many savers in Kenya and across Africa—access practical financial tools. Our peer-to-peer model lets people lend and borrow directly, with transparent terms secured by smart contracts.</p>
      <ul style="display:grid; grid-template-columns: repeat(3,1fr); gap:14px; padding-left:18px; margin-bottom:0">
        <li>Community-owned ethos</li>
        <li>Transparent collateral ratios</li>
        <li>Mobile-first UX</li>
        <li>Education-focused onboarding</li>
        <li>No-custody design (demo only)</li>
        <li>Open data dashboards (soon)</li>
      </ul>
    </section>
  </main>

  <footer class="wrap">
    <div style="display:flex; align-items:center; justify-content:space-between; gap:14px; flex-wrap:wrap">
      <small>© <span id="yr"></span> BitLend (demo). Built with pure HTML, CSS & JS.</small>
      <small>Made with ♥ for communities in Kenya & Africa.</small>
    </div>
  </footer>

  <script>
    // ===== Utilities =====
    const $ = s=>document.querySelector(s);
    const clamp = (v, min, max)=>Math.min(Math.max(v, min), max);
    const fmtBTC = n => Number(n).toFixed(4);
    const fmtUSD = n => '$' + Number(n).toFixed(2);

    // ===== Toasts / Badge Notifications =====
    function notify({title="", message="", type="ok", timeout=3800}={}){
      const wrap = $('#toasts');
      const el = document.createElement('div');
      el.className = `toast ${type}`;
      const icon = type === 'ok' ? '✓' : (type === 'err' ? '!' : 'i');
      el.innerHTML = `
        <div class="ico" aria-hidden="true">${icon}</div>
        <div class="body">
          <div class="title">${title}</div>
          <div class="msg">${message}</div>
        </div>
        <button class="close" aria-label="Dismiss">×</button>
      `;
      const remove = ()=>{ el.style.transition = 'opacity .18s ease, transform .18s ease'; el.style.opacity='0'; el.style.transform='translateY(-6px)'; setTimeout(()=>el.remove(),180); };
      el.querySelector('.close').onclick = remove;
      wrap.appendChild(el);
      if(timeout>0){ setTimeout(remove, timeout); }
    }

    // ===== Persistent Profile (nickname + avatar) =====
    const profile = {
      name: localStorage.getItem('bl_name') || '',
      seed: localStorage.getItem('bl_seed') || String(Math.random()),
    };

    // ===== Avatar Generator (canvas, no libs) =====
    function hashSeed(str){
      let h=0; for(let i=0;i<str.length;i++){h = Math.imul(31,h) + str.charCodeAt(i) | 0} return Math.abs(h);
    }
    function HSL(h,s,l){return `hsl(${h} ${s}% ${l}%)`}
    function drawAvatar(canvas, name, seed){
      const ctx = canvas.getContext('2d');
      const init = (name||'Guest').trim().split(/\s+/).map(p=>p[0]?.toUpperCase()).slice(0,2).join('') || 'BG';
      const base = hashSeed(seed + name);
      const hue = base % 360;
      const hue2 = (hue + 50 + (base%40)) % 360;
      const bgA = HSL(hue, 78, 18), bgB = HSL(hue2, 78, 26);

      const {width:w, height:h} = canvas;
      ctx.clearRect(0,0,w,h);
      const grd = ctx.createLinearGradient(0,0,w,h);
      grd.addColorStop(0, bgA); grd.addColorStop(1, bgB);
      ctx.fillStyle = grd; ctx.beginPath(); ctx.arc(w/2,h/2,w/2-6,0,Math.PI*2); ctx.fill();

      const rng = (min,max)=> (base * 9301 + 49297) % 233280 / 233280 * (max-min) + min;
      ctx.globalAlpha = .22; ctx.fillStyle = HSL((hue+200)%360,70,70);
      for(let i=0;i<5;i++){
        const r = rng(10, 40), x = rng(40, w-40), y = rng(40, h-40);
        ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill();
      }
      ctx.globalAlpha=1;

      ctx.fillStyle = '#fff';
      ctx.font = 'bold 120px system-ui,Segoe UI,Roboto';
      ctx.textAlign='center'; ctx.textBaseline='middle';
      ctx.shadowColor = '#0008'; ctx.shadowBlur=10;
      ctx.fillText(init, w/2, h/2+6);
    }

    function syncBadge(){
      $('#badgeName').textContent = profile.name || 'Guest';
      drawAvatar($('#badgeAvatar'), profile.name, profile.seed);
    }

    // ===== Splash -> Onboarding flow =====
    const splash = $('#splash');
    const startLocked = $('#startLocked');
    setTimeout(()=>{
      startLocked.textContent = 'Start';
      startLocked.style.cursor = 'pointer';
      startLocked.disabled = false;
      startLocked.onclick = ()=>{
        splash.style.display='none';
        openOnboarding();
      };
    }, 1800);

    function openOnboarding(){
      const dlg = $('#onboard'); dlg.showModal();
      const nameInput = $('#nickname');
      const avatarCanvas = $('#avatar');
      nameInput.value = profile.name || '';
      drawAvatar(avatarCanvas, profile.name||'Guest', profile.seed);

      $('#shuffleAvatar').onclick = ()=>{
        profile.seed = String(Math.random());
        drawAvatar(avatarCanvas, nameInput.value||'Guest', profile.seed);
      };
      $('#randomName').onclick = ()=>{
        const pool = ['Satoshi254','NairobiNode','KilimaniHodler','M-Pepe','SavannaSat','MtKenyaMiner','KiberaCoder','MasaiStacker'];
        nameInput.value = pool[Math.floor(Math.random()*pool.length)];
        drawAvatar(avatarCanvas, nameInput.value, profile.seed);
      };
      $('#enterApp').onclick = ()=>{
        profile.name = (nameInput.value||'Guest').trim().slice(0,28);
        localStorage.setItem('bl_name', profile.name);
        localStorage.setItem('bl_seed', profile.seed);
        syncBadge();
        dlg.close();
        notify({title:'Welcome, ' + profile.name + '!', message:'Your profile has been saved locally.', type:'ok'});
      };
    }

    // Auto-open onboarding for first-time users
    window.addEventListener('load', ()=>{
      $('#yr').textContent = new Date().getFullYear();
      syncBadge();
      if(!profile.name){ openOnboarding(); }
    });

    // ===== Typewriter (progressive reveal) =====
    (function(){
      const el = $('#typer');
      const text = el.textContent.trim();
      el.textContent = '';
      let i=0; const step=()=>{ if(i<=text.length){ el.textContent = text.slice(0,i++); requestAnimationFrame(step);} }; step();
    })();

    // ===== Scroll reveal =====
    const io = new IntersectionObserver(entries=>{
      entries.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('active'); io.unobserve(e.target);} });
    },{threshold:.2});
    document.querySelectorAll('.reveal').forEach(el=>io.observe(el));

    // ===== Wallet & Lending Demo Logic =====
    let isConnected = false; let btc = 0; let usdt = 0; const BTC_USD = 30000; const LTV=0.6;

    function updateUI(){
      $('#btcBalance').textContent = fmtBTC(btc);
      $('#usdtBalance').textContent = Number(usdt).toFixed(2);
      $('#walletStatus').textContent = isConnected? 'Connected ✅' : 'Not connected';
      const users = Math.max(1, Math.round( (hashSeed(profile.seed)%1200)+ (isConnected?3:0) ));
      $('#statUsers').textContent = users.toLocaleString();
      $('#statTVL').textContent = fmtBTC(btc);
      $('#statLoans').textContent = fmtUSD(usdt);
    }

    function connect(){ 
      isConnected = true; updateUI();
      notify({title:'Wallet Connected', message:'Demo wallet session active.', type:'ok'});
    }
    function disconnect(){ 
      isConnected = false; updateUI();
      notify({title:'Disconnected', message:'Wallet connection closed.', type:'err'});
    }

    function needConn(){ 
      if(!isConnected){ 
        notify({title:'Connect required', message:'Please connect your wallet to continue.', type:'err'}); 
        return true;
      }
      return false;
    }

    function deposit(){
      if(needConn()) return;
      const amt = parseFloat($('#inpDeposit').value);
      if(!(amt>0)) return notify({title:'Invalid amount', message:'Enter a valid BTC amount.', type:'err'});
      btc += amt; updateUI(); $('#inpDeposit').value='';
      notify({title:'Deposit successful', message:`Added ${fmtBTC(amt)} BTC to your collateral.`, type:'ok'});
    }
    function borrow(){
      if(needConn()) return;
      const maxBorrow = btc * LTV * BTC_USD;
      const amt = parseFloat($('#inpBorrow').value);
      if(!(amt>0)) return notify({title:'Invalid amount', message:'Enter a valid USDT amount.', type:'err'});
      const room = maxBorrow - usdt;
      if(amt > room + 1e-6) return notify({title:'Limit exceeded', message:`You can borrow up to ${fmtUSD(room)} right now.`, type:'err'});
      usdt += amt; updateUI(); $('#inpBorrow').value='';
      notify({title:'Borrowed', message:`You received ${fmtUSD(amt)} USDT.`, type:'ok'});
    }
    function repay(){
      if(needConn()) return;
      const amt = parseFloat($('#inpRepay').value);
      if(!(amt>0)) return notify({title:'Invalid amount', message:'Enter a valid USDT amount.', type:'err'});
      if(amt > usdt + 1e-6) return notify({title:'Too much', message:`You're trying to repay more than owed.`, type:'err'});
      usdt -= amt; updateUI(); $('#inpRepay').value='';
      notify({title:'Repayment successful', message:`You repaid ${fmtUSD(amt)}.`, type:'ok'});
    }
    function reset(){ 
      btc=0; usdt=0; updateUI(); 
      notify({title:'Reset complete', message:'Balances cleared for this demo session.', type:'ok'});
    }

    $('#btnConnect').onclick = connect;
    $('#connectWallet').onclick = connect;
    $('#disconnectWallet').onclick = disconnect;
    $('#btnDeposit').onclick = deposit;
    $('#btnBorrow').onclick = borrow;
    $('#btnRepay').onclick = repay;
    $('#btnReset').onclick = reset;
    $('#ctaDeposit').onclick = ()=> document.getElementById('inpDeposit').focus();
    $('#ctaLearn').onclick = ()=> notify({title:'How it works', message:'In production, this would open docs for collateral, LTV, liquidation, and on-chain verification.', type:'ok'});

    updateUI();
  </script>
</body>
</html>
